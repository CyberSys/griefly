version: 1.0.{build}
image: Visual Studio 2015

environment:
  QT5DIR: C:\Qt\5.8

install:
  - cmd: set CMAKE_PREFIX_PATH=%QT5DIR%\msvc2015_64

build_script:
  - cmd: cmake -G "Visual Studio 14 2015 Win64"  -DCMAKE_BUILD_TYPE=Release -DBUILD_TESTS=On
  - cmd: cmake --build . --target install --config Release -- /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"

after_build:
  - cmd: C:\Qt\5.8\msvc2015_64\bin\windeployqt.exe Exec/KVEngine.exe
  - cmd: for /f "tokens=* USEBACKQ" %%F in (`git describe --tags --abbrev^=4`) do set KVVERSION=%%F
  - cmd: echo %KVVERSION%
  - cmd: ren Exec Griefly-%KVVERSION%-win64

test_script:
  - cmd: cd Griefly-%KVVERSION%-win64
  - cmd: KVEngine.exe --run-tests

artifacts:
  - path: Griefly-%KVVERSION%-win64
    name: Griefly-%KVVERSION%-win64
